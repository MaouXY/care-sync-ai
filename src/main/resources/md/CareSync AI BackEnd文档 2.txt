# ç•™å®ˆå„¿ç«¥ AI æƒ…æ„Ÿé™ªä¼´ä¸æœåŠ¡é¡¹ç›® - åç«¯è®¾è®¡æ–¹æ¡ˆï¼ˆä¿®è®¢ç‰ˆï¼‰

åŸºäº â€œæ•°å­—äºº Sessions ç”± live talking æœåŠ¡ç”Ÿæˆï¼Œä»…éœ€ç»´æŠ¤â€˜æ•°å­—äººå®ä¾‹ç”»é¢ä¼ è¾“ + æ–‡æœ¬æŒ‡ä»¤åˆ†å‘â€™å…³è”â€ çš„æ ¸å¿ƒéœ€æ±‚ï¼Œåˆ é™¤ç‹¬ç«‹æ•°å­—äººä¼šè¯è¡¨ï¼Œå°†ä¼šè¯å…³è”é€»è¾‘èå…¥ç°æœ‰è¡¨ç»“æ„ï¼ŒåŒæ—¶ä¿ç•™åŸæœ‰è½»é‡åŒ–ã€é—­ç¯ä¼˜å…ˆçš„è®¾è®¡åŸåˆ™ï¼Œä¿®è®¢æ•°æ®åº“ã€æ¶æ„åŠæ¥å£è®¾è®¡å¦‚ä¸‹ï¼š

## ä¸€ã€æ•°æ®åº“è®¾è®¡ä¿®è®¢ï¼ˆPostgreSQL 15.xï¼‰

### 1. æ ¸å¿ƒè®¾è®¡åŸåˆ™è°ƒæ•´

- ç§»é™¤ç‹¬ç«‹`digital_person_session`è¡¨ï¼Œå°† livetalking ç”Ÿæˆçš„æ•°å­—äºº Session ID ä½œä¸º â€œå…³è”æ ‡è¯†â€ åµŒå…¥ç°æœ‰ä¸šåŠ¡è¡¨ï¼Œé¿å…æ•°æ®å†—ä½™ï¼›
- æ•°å­—äºº Sessions ä»…ç»´æŠ¤ â€œç”»é¢ä¼ è¾“å®ä¾‹ + æ–‡æœ¬æŒ‡ä»¤åˆ†å‘â€ æ ¸å¿ƒå…³è”ï¼Œä¸å­˜å‚¨é¢å¤–ä¼šè¯çŠ¶æ€ï¼ˆå¦‚ç»ˆç«¯ç±»å‹ã€é—²ç½®æ—¶é—´ï¼‰ï¼ŒçŠ¶æ€ç®¡ç†äº¤ç”± livetalking æœåŠ¡è´Ÿè´£ï¼›
- ä¿ç•™åŸæœ‰`JSONB`æ‰©å±•å­—æ®µã€æ—¶é—´æˆ³è¿½æº¯ã€æ ‡ç­¾åŒ–è®¾è®¡ç­‰åŸåˆ™ï¼Œç¡®ä¿åæœŸåŠŸèƒ½è¿­ä»£çµæ´»æ€§ã€‚

### 2. ä¿®è®¢åè¡¨ç»“æ„è¯¦æƒ…ï¼ˆå«å®Œæ•´å»ºè¡¨ SQLï¼‰

#### ï¼ˆ1ï¼‰å„¿ç«¥ä¿¡æ¯è¡¨ï¼ˆ`child`ï¼‰- æ— å˜æ›´

ç»´æŒåŸæœ‰ç»“æ„ï¼Œèšç„¦å„¿ç«¥åŸºç¡€ä¿¡æ¯ä¸ AI ç»“æ„åŒ–æ•°æ®å­˜å‚¨ï¼Œæ— éœ€æ–°å¢æ•°å­—äººç›¸å…³å­—æ®µï¼ˆæ•°å­—äºº Session ä¸å„¿ç«¥çš„å…³è”é€šè¿‡èŠå¤©è®°å½•é—´æ¥ç»‘å®šï¼‰ï¼š

```sql
CREATE TABLE child (
    id BIGSERIAL PRIMARY KEY, -- å„¿ç«¥å”¯ä¸€IDï¼ˆè‡ªå¢ï¼‰
    child_no VARCHAR(20) NOT NULL UNIQUE, -- å„¿ç«¥ç™»å½•IDï¼ˆç¤¾å·¥é¢„å…ˆåˆ›å»ºï¼‰
    name VARCHAR(50) NOT NULL, -- å„¿ç«¥å§“å
    age INT NOT NULL CHECK (age > 0), -- å„¿ç«¥å¹´é¾„
    verify_code VARCHAR(4) NOT NULL, -- 4ä½ç™»å½•éªŒè¯ç ï¼ˆBCryptåŠ å¯†å­˜å‚¨ï¼‰
    has_new_chat BOOLEAN DEFAULT FALSE, -- æ˜¯å¦æœ‰æ–°èŠå¤©è®°å½•ï¼ˆç¤¾å·¥ç«¯åˆ—è¡¨æ ‡æ³¨ï¼‰
    ai_struct_info JSONB, -- AIç»“æ„åŒ–ä¿¡æ¯ï¼šæƒ…æ„Ÿè¶‹åŠ¿ã€æ ¸å¿ƒéœ€æ±‚ç­‰ï¼ˆç¤ºä¾‹è§ä¸‹æ–‡ï¼‰
    ai_analysis_time TIMESTAMP, -- æœ€åä¸€æ¬¡AIåˆ†ææ—¶é—´ï¼ˆé¿å…é‡å¤åˆ†æï¼‰
    interest_tags JSONB, -- é¢„ç•™ï¼šå…´è¶£æ ‡ç­¾ï¼ˆå¦‚["ç«¥è¯","ç»˜ç”»"]ï¼‰
    study_situation JSONB, -- é¢„ç•™ï¼šå­¦ä¹ æƒ…å†µï¼ˆå¦‚{"math":"è‰¯å¥½"}ï¼‰
    create_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    update_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
-- ç´¢å¼•ï¼šä¼˜åŒ–ç™»å½•æŸ¥è¯¢ä¸æ–°æ¶ˆæ¯ç­›é€‰
CREATE INDEX idx_child_child_no ON child(child_no);
CREATE INDEX idx_child_has_new_chat ON child(has_new_chat);
-- TODO GINæ£€ç´¢ai_struct_info

-- ai_struct_infoæ‰©å±•ç»“æ„ç¤ºä¾‹
-- {
--   "emotion_trend": ["å­¤ç‹¬", "å¹³é™", "å¼€å¿ƒ"],
--   "core_needs": ["æ•…äº‹é™ªä¼´", "å­¦ä¹ è¾…å¯¼"],
--   "potential_problems": ["æ²Ÿé€šè¾ƒå°‘"],
--   "latest_analysis": "2025-10-31 15:30:00"
-- }
```

#### ï¼ˆ2ï¼‰AI èŠå¤©è®°å½•è¡¨ï¼ˆ`ai_chat_record`ï¼‰- æ–°å¢æ•°å­—äºº Session å…³è”å­—æ®µ

åµŒå…¥ live talking ç”Ÿæˆçš„`digi_session_id`ï¼Œç›´æ¥å…³è” â€œå„¿ç«¥èŠå¤©å†…å®¹â†’æ•°å­—äººå®ä¾‹â€ï¼Œæ”¯æ’‘ â€œæ–‡æœ¬æŒ‡ä»¤åˆ†å‘ + ç”»é¢ä¼ è¾“â€ åŒ¹é…ï¼š

```sql
CREATE TABLE ai_chat_record (
    id BIGSERIAL PRIMARY KEY,
    child_id BIGINT NOT NULL, -- å…³è”å„¿ç«¥ID
    session_id VARCHAR(50) NOT NULL, -- ä¸šåŠ¡ä¼šè¯IDï¼ˆå„¿ç«¥ä¸AIçš„èŠå¤©ä¼šè¯ï¼‰
    digi_session_id VARCHAR(50) NOT NULL, -- ğŸ‘‰ livetalkingç”Ÿæˆçš„æ•°å­—äººSession IDï¼ˆå…³è”å®ä¾‹ï¼‰ï¼Œä¸ºnullåˆ™ä¸ºAIæ–‡æœ¬å¯¹è¯ï¼Œéæ•°å­—äººè§†é¢‘å¯¹è¯ï¼
    round_num INT NOT NULL, -- ä¼šè¯å†…è½®æ¬¡ï¼ˆ1ã€2ã€3...ï¼‰
    content_type VARCHAR(10) NOT NULL CHECK (content_type IN ('VOICE', 'TEXT')), -- å†…å®¹ç±»å‹
    content TEXT NOT NULL, -- èŠå¤©å†…å®¹ï¼ˆè¯­éŸ³è½¬æ–‡å­—å/æ–‡æœ¬ç›´æ¥å­˜å‚¨ï¼‰
    is_ai_reply BOOLEAN NOT NULL, -- æ˜¯å¦AIå›å¤ï¼ˆTRUE=AIï¼ŒFALSE=å„¿ç«¥ï¼‰
    is_filtered BOOLEAN DEFAULT FALSE, -- å†…å®¹è¿‡æ»¤çŠ¶æ€
    emotion_tag VARCHAR(20), -- å•è½®æƒ…æ„Ÿæ ‡ç­¾ï¼ˆå¦‚â€œå¼€å¿ƒâ€â€œä½è½â€ï¼‰
    create_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    -- å¤–é”®ï¼šåˆ é™¤å„¿ç«¥æ—¶åŒæ­¥åˆ é™¤èŠå¤©è®°å½•
    FOREIGN KEY (child_id) REFERENCES child(id) ON DELETE CASCADE
);
-- ç´¢å¼•ä¼˜åŒ–ï¼šæŒ‰æ•°å­—äººSessionæŸ¥è¯¢å…³è”èŠå¤©ã€æŒ‰ä¸šåŠ¡ä¼šè¯æŸ¥è¯¢å®Œæ•´å¯¹è¯
CREATE INDEX idx_chat_digi_session ON ai_chat_record(digi_session_id); -- ğŸ‘‰ æ–°å¢æ•°å­—äººSessionç´¢å¼•
CREATE INDEX idx_chat_session ON ai_chat_record(session_id);
CREATE INDEX idx_chat_child_time ON ai_chat_record(child_id, create_time);
```

**æ ¸å¿ƒä½œç”¨**ï¼šé€šè¿‡`digi_session_id`å°†å„¿ç«¥çš„æ¯è½®èŠå¤©å†…å®¹ä¸ livetalking çš„æ•°å­—äººå®ä¾‹ç»‘å®šï¼Œåç«¯æ¥æ”¶å„¿ç«¥æ¶ˆæ¯åï¼Œæºå¸¦è¯¥ ID è°ƒç”¨ livetalking æ¥å£ï¼Œç¡®ä¿æ–‡æœ¬æŒ‡ä»¤åˆ†å‘åˆ°æ­£ç¡®å®ä¾‹ï¼ŒåŒæ—¶è·å–å¯¹åº”å®ä¾‹çš„ç”»é¢æµã€‚

#### ï¼ˆ3ï¼‰AI æœåŠ¡æ–¹æ¡ˆè¡¨ï¼ˆ`ai_assist_scheme`ï¼‰- æ— å˜æ›´

ç»´æŒ â€œAI å»ºè®® + ç¤¾å·¥å†³ç­–â€ åä½œç»“æ„ï¼Œæ•°å­—äººç›¸å…³æœåŠ¡æªæ–½ï¼ˆå¦‚ â€œAI æ•…äº‹æ¨é€â€ï¼‰é€šè¿‡`measures`æ•°ç»„å­˜å‚¨ï¼Œæ— éœ€å…³è”æ•°å­—äºº Sessionï¼ˆæ¨é€æ—¶ä¸´æ—¶è°ƒç”¨ live talking ç”Ÿæˆ Session å³å¯ï¼‰ï¼š

```sql
CREATE TABLE ai_assist_scheme (
    id BIGSERIAL PRIMARY KEY, -- æ–¹æ¡ˆID
    child_id BIGINT NOT NULL, -- å…³è”å„¿ç«¥ID
    worker_id BIGINT NOT NULL, -- å…³è”ç¤¾å·¥ID
    target VARCHAR(200) NOT NULL, -- æœåŠ¡ç›®æ ‡ï¼ˆå¦‚â€œç¼“è§£å­¤ç‹¬æ„Ÿâ€ï¼‰
    measures TEXT[] NOT NULL CHECK (array_length(measures, 1) <= 3), -- æªæ–½ï¼ˆæœ€å¤š3æ¡ï¼‰
    cycle INT DEFAULT 7, -- å‘¨æœŸï¼ˆé»˜è®¤1å‘¨ï¼‰
    scheme_status VARCHAR(20) DEFAULT 'DRAFT' CHECK (scheme_status IN ('DRAFT', 'IN_PROGRESS', 'COMPLETED')), -- æ–¹æ¡ˆçŠ¶æ€
    ai_suggestions JSONB NOT NULL, -- AIåŸå§‹å»ºè®®ï¼ˆå«ç›®æ ‡ã€æªæ–½ã€ä¾æ®ï¼‰
    worker_adjust_reason TEXT, -- ç¤¾å·¥è°ƒæ•´ç†ç”±
    ai_analysis_id BIGINT, -- å…³è”AIåˆ†æè®°å½•ID
    evaluation_index JSONB, -- é¢„ç•™ï¼šè¯„ä¼°æŒ‡æ ‡
    create_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    update_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    -- å¤–é”®å…³è”
    FOREIGN KEY (child_id) REFERENCES child(id) ON DELETE CASCADE,
    FOREIGN KEY (worker_id) REFERENCES social_worker(id) ON DELETE CASCADE,
    FOREIGN KEY (ai_analysis_id) REFERENCES ai_analysis_log(id) ON DELETE SET NULL
);
-- ç´¢å¼•ï¼šä¼˜åŒ–æ–¹æ¡ˆæŸ¥è¯¢ä¸çŠ¶æ€ç­›é€‰
CREATE INDEX idx_scheme_child_worker ON ai_assist_scheme(child_id, worker_id);
CREATE INDEX idx_scheme_status ON ai_assist_scheme(scheme_status);

-- ai_suggestionsç¤ºä¾‹ï¼ˆå«æ•°å­—äººç›¸å…³å»ºè®®ï¼‰
-- {
--   "target_suggest": ["ç¼“è§£å­¤ç‹¬æ„Ÿ"],
--   "measures_suggest": ["æ¯å‘¨3æ¬¡AIæ•…äº‹æ¨é€ï¼ˆæ•°å­—äººæ’­æŠ¥ï¼Œåå¥½ç«¥è¯ç±»ï¼‰"],
--   "basis": "è¿‘5æ¬¡å¯¹è¯ä¸­ï¼Œå„¿ç«¥3æ¬¡æåˆ°â€œæƒ³å¬æ•…äº‹â€"
-- }
```

#### ï¼ˆ4ï¼‰æœåŠ¡è·Ÿè¸ªæ—¥å¿—è¡¨ï¼ˆ`assist_track_log`ï¼‰

å­˜å‚¨ç¤¾å·¥çš„æœåŠ¡è¿›åº¦è®°å½•ï¼Œæ”¯æ’‘ â€œé—­ç¯äº®ç‚¹â€

```sql
CREATE TABLE assist_track_log (
    id BIGSERIAL PRIMARY KEY, -- æ—¥å¿—ID
    scheme_id BIGINT NOT NULL, -- å…³è”æœåŠ¡æ–¹æ¡ˆID
    worker_id BIGINT NOT NULL, -- å…³è”ç¤¾å·¥IDï¼ˆè®°å½•äººï¼‰
    week INT NOT NULL, -- æœåŠ¡å‘¨æ¬¡ï¼ˆå¦‚â€œç¬¬1å‘¨â€â€œç¬¬2å‘¨â€ï¼‰
    completion_status VARCHAR(20) NOT NULL, -- å®ŒæˆçŠ¶æ€ï¼šCOMPLETEDï¼ˆå·²å®Œæˆï¼‰/UNFINISHEDï¼ˆæœªå®Œæˆï¼‰
    record_content TEXT NOT NULL, -- è®°å½•å†…å®¹ï¼ˆå¦‚â€œå·²å®Œæˆ1æ¬¡ç”µè¯æ²Ÿé€šâ€ï¼‰
    create_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    -- å¤–é”®å…³è”ï¼šåˆ é™¤æ–¹æ¡ˆæ—¶åŒæ­¥åˆ é™¤æ—¥å¿—
    FOREIGN KEY (scheme_id) REFERENCES ai_assist_scheme(id) ON DELETE CASCADE,
    FOREIGN KEY (worker_id) REFERENCES social_worker(id) ON DELETE CASCADE
);
-- ç´¢å¼•ï¼šä¼˜åŒ–ç¤¾å·¥æŸ¥è¯¢æ–¹æ¡ˆè¿›åº¦ã€å‘¨æ¬¡ç­›é€‰
CREATE INDEX idx_track_scheme_id ON assist_track_log(scheme_id);
CREATE INDEX idx_track_week ON assist_track_log(week);
```

#### ï¼ˆ5ï¼‰AI åˆ†æè®°å½•è¡¨ï¼ˆ`ai_analysis_log`ï¼‰

 è·Ÿè¸ªç»“æ„åŒ–ä¿¡æ¯æ¥æº

è®°å½•æ¯æ¬¡ AI åˆ†æçš„è§¦å‘æ—¶æœºã€ä¾æ®å¯¹è¯èŒƒå›´åŠç»“æœï¼Œä¾¿äºç¤¾å·¥è¿½æº¯ï¼š

```sql
CREATE TABLE ai_analysis_log (
    id BIGSERIAL PRIMARY KEY,
    child_id BIGINT NOT NULL,
    session_ids TEXT[], -- æœ¬æ¬¡åˆ†ææ¶‰åŠçš„ä¼šè¯IDåˆ—è¡¨ï¼ˆå¦‚{"session1","session2"}ï¼‰
    analysis_result JSONB NOT NULL, -- å®Œæ•´åˆ†æç»“æœï¼ˆä¸child.ai_struct_infoå…³è”ï¼‰
    trigger_type VARCHAR(20) NOT NULL, -- è§¦å‘æ–¹å¼ï¼šAUTOï¼ˆå®šæ—¶ï¼‰/MANUALï¼ˆç¤¾å·¥æ‰‹åŠ¨è§¦å‘ï¼‰
    create_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (child_id) REFERENCES child(id) ON DELETE CASCADE
);
-- ç´¢å¼•ï¼šæŒ‰å„¿ç«¥æŸ¥è¯¢åˆ†æå†å²
CREATE INDEX idx_analysis_child ON ai_analysis_log(child_id);
```

#### ï¼ˆ6ï¼‰ç¤¾å·¥ä¿¡æ¯è¡¨ï¼ˆ`social_worker`ï¼‰

å­˜å‚¨ç¤¾å·¥è´¦å·ä¿¡æ¯åŠæƒé™ç›¸å…³æ•°æ®

```sql
CREATE TABLE social_worker (
    id BIGSERIAL PRIMARY KEY, -- ç¤¾å·¥å”¯ä¸€ID
    worker_no VARCHAR(20) NOT NULL UNIQUE, -- ç¤¾å·¥è´¦å·
    password VARCHAR(100) NOT NULL, -- å¯†ç ï¼ˆBCryptåŠ å¯†å­˜å‚¨ï¼‰
    name VARCHAR(50) NOT NULL, -- ç¤¾å·¥å§“å
    phone VARCHAR(20) NOT NULL, -- ç¤¾å·¥è”ç³»ç”µè¯ï¼ˆç”¨äºå„¿ç«¥ç«¯ç´§æ€¥å‘¼å«ï¼‰
    role VARCHAR(20) DEFAULT 'NORMAL', -- è§’è‰²ï¼šNORMALï¼ˆæ™®é€šç¤¾å·¥ï¼‰/ADMINï¼ˆç®¡ç†å‘˜ï¼Œé¢„ç•™ï¼‰
    create_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    update_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
-- ç´¢å¼•ï¼šä¼˜åŒ–ç¤¾å·¥ç™»å½•æŸ¥è¯¢
CREATE INDEX idx_social_worker_worker_no ON social_worker(worker_no);
```

## äºŒã€åç«¯æ¶æ„è®¾è®¡ä¿®è®¢ï¼ˆSpringBoot 3.xï¼‰

### 1. æ•´ä½“æ¶æ„åˆ†å±‚è°ƒæ•´

ç§»é™¤åŸæœ‰`digital_person_session`ç›¸å…³çš„å®ä½“ã€æœåŠ¡ä¸ DAOï¼Œæ–°å¢`LivetalkingClient`å·¥å…·ç±»ï¼Œèšç„¦ â€œæ•°å­—äºº Session å…³è” + æ¥å£è°ƒç”¨â€ï¼Œæ¶æ„åˆ†å±‚æ›´è½»é‡åŒ–ï¼š

```plaintext
com.child.ai
â”œâ”€â”€ config/          # é…ç½®å±‚ï¼šæ–°å¢livetalkingæœåŠ¡é…ç½®
â”œâ”€â”€ controller/      # æ§åˆ¶å±‚ï¼šè°ƒæ•´å„¿ç«¥ç«¯èŠå¤©æ¥å£ï¼Œæ–°å¢æ•°å­—äººSessionå‚æ•°
â”œâ”€â”€ service/         # æœåŠ¡å±‚ï¼šAiChatServiceé›†æˆlivetalkingè°ƒç”¨é€»è¾‘
â”‚   â”œâ”€â”€ impl/
â”œâ”€â”€ mapper/          # æ•°æ®è®¿é—®å±‚ï¼šè°ƒæ•´AIèŠå¤©è®°å½•Mapperï¼Œæ–°å¢digi_session_idå­—æ®µæ˜ å°„
â”œâ”€â”€ model/           # æ¨¡å‹å±‚ï¼šAIèŠå¤©è®°å½•å®ä½“æ–°å¢digi_session_idå­—æ®µ
â”‚   â”œâ”€â”€ entity/
â”‚   â”œâ”€â”€ dto/         # æ–°å¢æ•°å­—äººSessionç›¸å…³DTOï¼ˆå¦‚DigiSessionBindDTOï¼‰
â”‚   â”œâ”€â”€ vo/
â”œâ”€â”€ client/          # ğŸ‘‰ æ–°å¢å®¢æˆ·ç«¯å±‚ï¼šå°è£…livetalkingæœåŠ¡è°ƒç”¨
â”‚   â”œâ”€â”€ LivetalkingClient.java
â”œâ”€â”€ exception/       # å¼‚å¸¸å±‚ï¼šæ–°å¢livetalkingè°ƒç”¨å¼‚å¸¸å¤„ç†
â”œâ”€â”€ util/            # å·¥å…·å±‚ï¼šæ— å˜æ›´
â””â”€â”€ CareSyncAiApplication.java  # å¯åŠ¨ç±»
```

### 2. æ ¸å¿ƒæ¨¡å—ä¿®è®¢

#### ï¼ˆ1ï¼‰é…ç½®å±‚ï¼ˆconfigï¼‰- æ–°å¢ Livetalking é…ç½®

æ–°å¢`LivetalkingConfig`ï¼Œå­˜å‚¨æœåŠ¡åœ°å€ã€API å¯†é’¥ç­‰ä¿¡æ¯ï¼Œé€šè¿‡`@Bean`æ³¨å…¥å®¢æˆ·ç«¯å®ä¾‹ï¼š

```java
@Configuration
public class LivetalkingConfig {
    @Value("${livetalking.base-url}")
    private String baseUrl;
    @Value("${livetalking.api-key}")
    private String apiKey;

    @Bean
    public LivetalkingClient livetalkingClient() {
        return new LivetalkingClient(baseUrl, apiKey);
    }
}
```

**é…ç½®ç¤ºä¾‹ï¼ˆapplication.ymlï¼‰**ï¼š

```yaml
livetalking:
  base-url: "https://livetalking-api.com/v1" # livetalkingæœåŠ¡åœ°å€
  api-key: "digi_ak_123456" # æ¥å£è°ƒç”¨å¯†é’¥
  session-expire: 3600 # æ•°å­—äººSessionæœ‰æ•ˆæœŸï¼ˆç§’ï¼Œé»˜è®¤1å°æ—¶ï¼‰
```

#### ï¼ˆ2ï¼‰å®¢æˆ·ç«¯å±‚ï¼ˆclientï¼‰- å°è£… Livetalking è°ƒç”¨

æ–°å¢`LivetalkingClient`ï¼Œå°è£… â€œåˆ›å»ºæ•°å­—äºº Sessionâ€â€œå‘é€æ–‡æœ¬æŒ‡ä»¤â€â€œè·å–ç”»é¢æµåœ°å€â€ ç­‰æ ¸å¿ƒæ¥å£ï¼Œé¿å…ä¸šåŠ¡å±‚ç›´æ¥ä¾èµ–ç¬¬ä¸‰æ–¹æœåŠ¡ç»†èŠ‚ï¼š

```java
/**
 * LivetalkingæœåŠ¡å®¢æˆ·ç«¯ï¼šå¤„ç†æ•°å­—äººSessionåˆ›å»ºã€æŒ‡ä»¤åˆ†å‘ã€ç”»é¢æµè·å–
 */
@Component
public class LivetalkingClient {
    private final RestTemplate restTemplate;
    private final String baseUrl;
    private final String apiKey;

    // æ„é€ å‡½æ•°æ³¨å…¥ä¾èµ–
    public LivetalkingClient(String baseUrl, String apiKey) {
        this.baseUrl = baseUrl;
        this.apiKey = apiKey;
        this.restTemplate = new RestTemplate();
    }

    /**
     * 1. åˆ›å»ºæ•°å­—äººSessionï¼ˆå„¿ç«¥å‘èµ·èŠå¤©æ—¶è°ƒç”¨ï¼‰
     * @param digiId æ•°å­—äººIDï¼ˆå¦‚"lively_001"ï¼‰
     * @return æ•°å­—äººSessionä¿¡æ¯ï¼ˆå«digiSessionIdã€streamUrlï¼‰
     */
    public DigiSessionVO createDigiSession(String digiId) {
        String url = baseUrl + "/digi/session/create";
        HttpHeaders headers = new HttpHeaders();
        headers.set("X-API-Key", apiKey);
        headers.setContentType(MediaType.APPLICATION_JSON);

        Map<String, String> request = new HashMap<>();
        request.put("digiId", digiId);
        HttpEntity<Map<String, String>> entity = new HttpEntity<>(request, headers);

        return restTemplate.postForObject(url, entity, DigiSessionVO.class);
    }

    /**
     * 2. å‘é€æ–‡æœ¬æŒ‡ä»¤åˆ°æ•°å­—äººå®ä¾‹ï¼ˆå„¿ç«¥å‘é€æ¶ˆæ¯æ—¶è°ƒç”¨ï¼‰
     * @param digiSessionId livestalkingç”Ÿæˆçš„Session ID
     * @param text æ–‡æœ¬æŒ‡ä»¤ï¼ˆå¦‚å„¿ç«¥æ¶ˆæ¯è½¬æ–‡å­—åå†…å®¹ï¼‰
     * @return æ•°å­—äººå“åº”ï¼ˆå«ç”»é¢æµæ›´æ–°æ ‡è¯†ã€è¯­éŸ³æ’­æŠ¥æ–‡æœ¬ï¼‰
     */
    public DigiCommandResponse sendTextCommand(String digiSessionId, String text) {
        String url = baseUrl + "/digi/session/" + digiSessionId + "/command";
        // ç±»ä¼¼åˆ›å»ºSessionçš„è¯·æ±‚å°è£…é€»è¾‘ï¼Œçœç•¥...
    }

    /**
     * 3. å…³é—­æ•°å­—äººSessionï¼ˆå„¿ç«¥ç»“æŸèŠå¤©æ—¶è°ƒç”¨ï¼‰
     * @param digiSessionId æ•°å­—äººSession ID
     * @return å…³é—­ç»“æœï¼ˆsuccess: true/falseï¼‰
     */
    public boolean closeDigiSession(String digiSessionId) {
        String url = baseUrl + "/digi/session/" + digiSessionId + "/close";
        //  DELETEè¯·æ±‚é€»è¾‘ï¼Œçœç•¥...
    }
}
```

**æ ¸å¿ƒ DTO/VO å®šä¹‰**ï¼š

- `DigiSessionVO`ï¼šå­˜å‚¨åˆ›å»º Session åçš„è¿”å›ç»“æœï¼ˆ`digiSessionId`ï¼šæ•°å­—äºº Session IDï¼›`streamUrl`ï¼šç”»é¢æµåœ°å€ï¼‰ï¼›
- `DigiCommandResponse`ï¼šå­˜å‚¨æ–‡æœ¬æŒ‡ä»¤çš„å“åº”ï¼ˆ`streamUpdated`ï¼šç”»é¢æµæ˜¯å¦æ›´æ–°ï¼›`voiceText`ï¼šæ•°å­—äººæ’­æŠ¥çš„è¯­éŸ³æ–‡æœ¬ï¼‰ã€‚

#### ï¼ˆ3ï¼‰æœåŠ¡å±‚ï¼ˆserviceï¼‰- AiChatService é›†æˆæ•°å­—äººé€»è¾‘

ä¿®æ”¹`AiChatService`ï¼Œåœ¨å„¿ç«¥èŠå¤©æµç¨‹ä¸­é›†æˆ â€œåˆ›å»ºæ•°å­—äºº Sessionâ†’ç»‘å®šä¼šè¯â†’å‘é€æŒ‡ä»¤â†’å­˜å‚¨è®°å½•â€ çš„å®Œæ•´é€»è¾‘ï¼š

```java
@Service
public class AiChatServiceImpl implements AiChatService {
    @Autowired
    private LivetalkingClient livetalkingClient;
    @Autowired
    private AiChatRecordMapper chatRecordMapper;
    @Autowired
    private AiAnalysisService aiAnalysisService;

    /**
     * å„¿ç«¥å‘é€èŠå¤©æ¶ˆæ¯ï¼ˆå«æ•°å­—äººSessionå…³è”ï¼‰
     */
    @Override
    public ChatResponseDTO sendChatMessage(ChatSendDTO dto) {
        Long childId = dto.getChildId();
        String content = dto.getContent();
        String contentType = dto.getContentType();
        String sessionId = dto.getSessionId(); // ä¸šåŠ¡ä¼šè¯IDï¼ˆå„¿ç«¥ä¸AIçš„èŠå¤©ä¼šè¯ï¼‰

        // æ­¥éª¤1ï¼šè‹¥é¦–æ¬¡èŠå¤©ï¼ˆæ— digiSessionIdï¼‰ï¼Œè°ƒç”¨livetalkingåˆ›å»ºæ•°å­—äººSession
        String digiSessionId = dto.getDigiSessionId();
        if (StringUtils.isEmpty(digiSessionId)) {
            DigiSessionVO digiSession = livetalkingClient.createDigiSession("lively_001"); // é»˜è®¤ä½¿ç”¨æ´»æ³¼å‹æ•°å­—äºº
            digiSessionId = digiSession.getDigiSessionId();
        }

        // æ­¥éª¤2ï¼šå†…å®¹å¤„ç†ï¼ˆè¯­éŸ³è½¬æ–‡å­—ã€æ–‡æœ¬è¿‡æ»¤ï¼‰
        String processedContent = processContent(content, contentType); // é›†æˆé˜¿é‡Œäº‘ASRä¸å†…å®¹å®‰å…¨

        // æ­¥éª¤3ï¼šè°ƒç”¨livetalkingå‘é€æ–‡æœ¬æŒ‡ä»¤ï¼Œè·å–æ•°å­—äººå“åº”
        DigiCommandResponse digiResp = livetalkingClient.sendTextCommand(digiSessionId, processedContent);

        // æ­¥éª¤4ï¼šè°ƒç”¨AIæ¨¡å‹ç”Ÿæˆå›å¤æ–‡æœ¬
        String aiReply = generateAiReply(processedContent, childId); // å¯¹æ¥å¤–éƒ¨AIæ¨¡å‹ï¼ˆå¦‚Claudeï¼‰

        // æ­¥éª¤5ï¼šæŸ¥è¯¢å½“å‰ä¼šè¯çš„æœ€å¤§è½®æ¬¡ï¼Œç¡®å®šæœ¬è½®è½®æ¬¡
        Integer maxRound = chatRecordMapper.getMaxRoundBySessionId(sessionId);
        int roundNum = maxRound == null ? 1 : maxRound + 1;

        // æ­¥éª¤6ï¼šå­˜å‚¨èŠå¤©è®°å½•ï¼ˆå«digiSessionIdï¼‰
        AiChatRecord record = new AiChatRecord();
        record.setChildId(childId);
        record.setSessionId(sessionId);
        record.setDigiSessionId(digiSessionId); // ğŸ‘‰ ç»‘å®šæ•°å­—äººSession
        record.setRoundNum(roundNum);
        record.setContentType(contentType);
        record.setContent(processedContent);
        record.setIsAiReply(false); // å„¿ç«¥æ¶ˆæ¯
        record.setIsFiltered(true); // å·²è¿‡æ»¤
        record.setEmotionTag(extractEmotionTag(processedContent)); // æå–æƒ…æ„Ÿæ ‡ç­¾
        chatRecordMapper.insert(record);

        // æ­¥éª¤7ï¼šå­˜å‚¨AIå›å¤è®°å½•
        AiChatRecord aiRecord = new AiChatRecord();
        // ç±»ä¼¼å„¿ç«¥è®°å½•çš„èµ‹å€¼ï¼Œä»…isAiReplyè®¾ä¸ºtrueï¼Œcontentè®¾ä¸ºaiReplyï¼Œçœç•¥...
        chatRecordMapper.insert(aiRecord);

        // æ­¥éª¤8ï¼šæ¯3è½®å¯¹è¯è§¦å‘ä¸€æ¬¡AIåˆ†æï¼Œæ›´æ–°å„¿ç«¥ç»“æ„åŒ–ä¿¡æ¯
        if (roundNum % 3 == 0) {
            aiAnalysisService.autoAnalyze(childId, Collections.singletonList(sessionId));
        }

        // æ­¥éª¤9ï¼šè¿”å›ç»“æœï¼ˆå«æ•°å­—äººSession IDã€AIå›å¤ã€ç”»é¢æµåœ°å€ï¼‰
        return ChatResponseDTO.builder()
                .aiReply(aiReply)
                .digiSessionId(digiSessionId)
                .streamUrl(digiResp.getStreamUrl()) // æ•°å­—äººç”»é¢æµåœ°å€
                .roundNum(roundNum)
                .build();
    }

    // è¾…åŠ©æ–¹æ³•ï¼šå†…å®¹å¤„ç†ï¼ˆè¯­éŸ³è½¬æ–‡å­—ã€è¿‡æ»¤ï¼‰ã€AIå›å¤ç”Ÿæˆã€æƒ…æ„Ÿæ ‡ç­¾æå–ï¼Œçœç•¥...
}
```

#### ï¼ˆ4ï¼‰å¼‚å¸¸å±‚ï¼ˆexceptionï¼‰- æ–°å¢ Livetalking å¼‚å¸¸å¤„ç†

åœ¨`GlobalExceptionHandler`ä¸­æ–°å¢`LivetalkingException`å¤„ç†é€»è¾‘ï¼Œè¿”å›ç»Ÿä¸€é”™è¯¯æ ¼å¼ï¼Œä¾¿äºå‰ç«¯æ’æŸ¥é—®é¢˜ï¼š

```java
@RestControllerAdvice
public class GlobalExceptionHandler {
    // å…¶ä»–å¼‚å¸¸å¤„ç†æ–¹æ³•...

    /**
     * å¤„ç†livetalkingæœåŠ¡è°ƒç”¨å¼‚å¸¸ï¼ˆå¦‚Sessionåˆ›å»ºå¤±è´¥ã€æŒ‡ä»¤å‘é€è¶…æ—¶ï¼‰
     */
    @ExceptionHandler(LivetalkingException.class)
    public ResponseEntity<BaseResponse> handleLivetalkingException(LivetalkingException e) {
        BaseResponse response = new BaseResponse();
        response.setCode(503); // æœåŠ¡ä¸å¯ç”¨
        response.setMsg("æ•°å­—äººæœåŠ¡å¼‚å¸¸ï¼š" + e.getMessage());
        response.setData(null);
        return new ResponseEntity<>(response, HttpStatus.SERVICE_UNAVAILABLE);
    }
}

// è‡ªå®šä¹‰Livetalkingå¼‚å¸¸
public class LivetalkingException extends RuntimeException {
    public LivetalkingException(String message) {
        super(message);
    }
}
```

## ä¸‰ã€æ¥å£è®¾è®¡ä¿®è®¢ï¼ˆRESTful é£æ ¼ï¼‰

### 1. æ¥å£é€šç”¨è§„èŒƒ

- ç»Ÿä¸€å‰ç¼€ï¼šå„¿ç«¥ç«¯`/api/child`ï¼Œç¤¾å·¥ç«¯`/api/social-worker`ï¼›

- è¯·æ±‚æ–¹å¼ï¼š`GET`ï¼ˆæŸ¥è¯¢ï¼‰ã€`POST`ï¼ˆåˆ›å»º / æäº¤ï¼‰ã€`PUT`ï¼ˆç¼–è¾‘ï¼‰ï¼›

- å“åº”æ ¼å¼ï¼šç»Ÿä¸€ JSON ç»“æ„ï¼ŒåŒ…å«çŠ¶æ€ç ã€æ¶ˆæ¯ã€æ•°æ®ï¼š

  ```json
  {
    "code": 200, // 200=æˆåŠŸï¼Œ400=å‚æ•°é”™è¯¯ï¼Œ401=æœªç™»å½•ï¼Œ500=æœåŠ¡å™¨é”™è¯¯
    "msg": "æ“ä½œæˆåŠŸ",
    "data": {} // ä¸šåŠ¡æ•°æ®ï¼ˆå¦‚ç™»å½•ä»¤ç‰Œã€å„¿ç«¥åˆ—è¡¨ï¼‰
  }
  ```

  

- è®¤è¯æ–¹å¼ï¼šç™»å½•æˆåŠŸåè¿”å› JWT ä»¤ç‰Œï¼Œåç»­æ¥å£é€šè¿‡`Authorization`è¯·æ±‚å¤´æºå¸¦ï¼ˆ`Bearer {token}`ï¼‰ã€‚

### 2. å„¿ç«¥ç«¯æ ¸å¿ƒæ¥å£ä¿®è®¢ - èŠå¤©æ¥å£æ–°å¢æ•°å­—äºº Session å‚æ•°

è°ƒæ•´`AIèŠå¤©æ¥å£`çš„å…¥å‚ï¼Œæ–°å¢`digiSessionId`å­—æ®µï¼ˆé¦–æ¬¡èŠå¤©å¯ç©ºï¼Œåç»­éœ€æºå¸¦ï¼‰ï¼Œå‡ºå‚æ–°å¢`digiSessionId`ä¸`streamUrl`ï¼ˆæ•°å­—äººç”»é¢æµåœ°å€ï¼‰ï¼š

| æ¥å£è·¯å¾„             | è¯·æ±‚æ–¹å¼ | æ¥å£æè¿°                       | å…¥å‚ï¼ˆDTOï¼‰æ–°å¢ / è°ƒæ•´                                       | å‡ºå‚ï¼ˆdataï¼‰æ–°å¢ / è°ƒæ•´                                      |
| -------------------- | -------- | ------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ |
| `/api/child/ai/chat` | POST     | å„¿ç«¥ä¸ AI èŠå¤©ï¼ˆå«æ•°å­—äººäº¤äº’ï¼‰ | æ–°å¢`digiSessionId`ï¼ˆStringï¼Œå¯é€‰ï¼‰ï¼šlivetalking ç”Ÿæˆçš„æ•°å­—äºº Session ID | æ–°å¢`digiSessionId`ï¼ˆStringï¼‰ã€`streamUrl`ï¼ˆStringï¼‰ï¼šæ•°å­—äººç”»é¢æµåœ°å€ |

**å…¥å‚ç¤ºä¾‹ï¼ˆChatSendDTOï¼‰**ï¼š

```json
{
  "childId": 123,
  "sessionId": "chat_123_1730000000", // ä¸šåŠ¡ä¼šè¯ID
  "digiSessionId": "digi_123_789", // é¦–æ¬¡èŠå¤©å¯ç©ºï¼Œåç»­éœ€æºå¸¦
  "contentType": "TEXT",
  "content": "æˆ‘æƒ³å¬æ•…äº‹"
}
```

**å‡ºå‚ç¤ºä¾‹ï¼ˆChatResponseDTOï¼‰**ï¼š

```json
{
  "code": 200,
  "msg": "æ“ä½œæˆåŠŸ",
  "data": {
    "aiReply": "å¥½å‘€ï¼Œç»™ä½ è®²ä¸ªã€Šå°å…”å­æ‰¾æœ‹å‹ã€‹çš„æ•…äº‹...",
    "digiSessionId": "digi_123_789",
    "streamUrl": "wss://livetalking-stream.com/stream/digi_123_789", // æ•°å­—äººç”»é¢æµåœ°å€
    "roundNum": 1,
    "emotionTag": "æœŸå¾…"
  }
}
```

### 3. æ–°å¢å„¿ç«¥ç«¯æ•°å­—äºº Session å…³é—­æ¥å£

ç”¨äºå„¿ç«¥ä¸»åŠ¨ç»“æŸæ•°å­—äººäº¤äº’æ—¶ï¼Œé€šçŸ¥ livetalking å…³é—­å¯¹åº”å®ä¾‹ï¼Œé¿å…èµ„æºæµªè´¹ï¼š

| æ¥å£è·¯å¾„                        | è¯·æ±‚æ–¹å¼ | æ¥å£æè¿°           | å…¥å‚ï¼ˆDTOï¼‰                     | å‡ºå‚ï¼ˆdataï¼‰                       |
| ------------------------------- | -------- | ------------------ | ------------------------------- | ---------------------------------- |
| `/api/child/digi/session/close` | POST     | å…³é—­æ•°å­—äºº Session | `digiSessionId`ï¼ˆStringï¼Œå¿…å¡«ï¼‰ | `success`ï¼ˆbooleanï¼‰ï¼šæ˜¯å¦å…³é—­æˆåŠŸ |

### 4. ç¤¾å·¥ç«¯æ ¸å¿ƒæ¥å£

ç¤¾å·¥ç«¯æ ¸å¿ƒæ¥å£ï¼ˆå„¿ç«¥ç®¡ç†ã€æ–¹æ¡ˆç”Ÿæˆã€æœåŠ¡è·Ÿè¸ªï¼‰ç»´æŒåŸæœ‰é€»è¾‘ï¼Œä»…åœ¨ â€œæ–¹æ¡ˆç”Ÿæˆâ€ çš„ AI å»ºè®®ä¸­å¯èƒ½åŒ…å«æ•°å­—äººç›¸å…³æªæ–½ï¼ˆå¦‚ â€œæ•°å­—äººæ•…äº‹æ¨é€â€ï¼‰ï¼Œæ— éœ€æ–°å¢æ•°å­—äºº Session ç›¸å…³æ¥å£ã€‚

#### ï¼ˆ1ï¼‰å„¿ç«¥ç®¡ç†æ¨¡å—

| æ¥å£è·¯å¾„                          | è¯·æ±‚æ–¹å¼ | æ¥å£æè¿°                         | å…¥å‚ï¼ˆDTOï¼‰                                                  | å‡ºå‚ï¼ˆdataï¼‰                                   |
| --------------------------------- | -------- | -------------------------------- | ------------------------------------------------------------ | ---------------------------------------------- |
| `/api/social-worker/child/list`   | GET      | è·å–å„¿ç«¥åˆ—è¡¨ï¼ˆåˆ†é¡µï¼‰             | `pageNum`ï¼ˆé¡µç ï¼‰ã€`pageSize`ï¼ˆæ¯é¡µæ¡æ•°ï¼‰ã€`hasNewChat`ï¼ˆå¯é€‰ï¼Œç­›é€‰æ–°æ¶ˆæ¯ï¼‰ | åˆ†é¡µå¯¹è±¡ï¼ˆ`list`ï¼šå„¿ç«¥åˆ—è¡¨ VOã€`total`ï¼šæ€»æ•°ï¼‰ |
| `/api/social-worker/child/detail` | GET      | è·å–å„¿ç«¥è¯¦æƒ…ï¼ˆå« AI ç»“æ„åŒ–ä¿¡æ¯ï¼‰ | `childId`                                                    | å„¿ç«¥è¯¦æƒ… VOï¼ˆ`name`/`age`/`aiStructInfo`ç­‰ï¼‰   |

#### ï¼ˆ2ï¼‰æœåŠ¡æ–¹æ¡ˆæ¨¡å—

| æ¥å£è·¯å¾„                             | è¯·æ±‚æ–¹å¼ | æ¥å£æè¿°             | å…¥å‚ï¼ˆDTOï¼‰                                      | å‡ºå‚ï¼ˆdataï¼‰                               |
| ------------------------------------ | -------- | -------------------- | ------------------------------------------------ | ------------------------------------------ |
| `/api/social-worker/scheme/generate` | POST     | 1 é”®ç”Ÿæˆ AI æœåŠ¡æ–¹æ¡ˆ | `childId`ã€`workerId`                            | æœåŠ¡æ–¹æ¡ˆ VOï¼ˆ`target`/`measures`/`cycle`ï¼‰ |
| `/api/social-worker/scheme/edit`     | PUT      | ç¼–è¾‘æœåŠ¡æ–¹æ¡ˆ         | `schemeId`ã€`target`ï¼ˆå¯é€‰ï¼‰ã€`measures`ï¼ˆå¯é€‰ï¼‰ | ç¼–è¾‘åçš„æ–¹æ¡ˆ VO                            |
| `/api/social-worker/scheme/export`   | GET      | å¯¼å‡ºæœåŠ¡æ–¹æ¡ˆï¼ˆPDFï¼‰  | `schemeId`                                       | `fileUrl`ï¼ˆPDF ä¸‹è½½é“¾æ¥ï¼‰                  |

#### ï¼ˆ3ï¼‰æœåŠ¡è·Ÿè¸ªæ¨¡å—

| æ¥å£è·¯å¾„                                | è¯·æ±‚æ–¹å¼ | æ¥å£æè¿°                     | å…¥å‚ï¼ˆDTOï¼‰                                             | å‡ºå‚ï¼ˆdataï¼‰                                             |
| --------------------------------------- | -------- | ---------------------------- | ------------------------------------------------------- | -------------------------------------------------------- |
| `/api/social-worker/track/add-log`      | POST     | æ·»åŠ æœåŠ¡æ—¥å¿—                 | `schemeId`ã€`week`ã€`completionStatus`ã€`recordContent` | æ—¥å¿— ID                                                  |
| `/api/social-worker/track/get-progress` | GET      | è·å–æ–¹æ¡ˆæœåŠ¡è¿›åº¦ï¼ˆå„å‘¨çŠ¶æ€ï¼‰ | `schemeId`                                              | è¿›åº¦åˆ—è¡¨ VOï¼ˆ`week`/`completionStatus`/`recordContent`ï¼‰ |

## å››ã€é¢„ç•™æ‰©å±•è®¾è®¡ä¿®è®¢

1. **æ•°å­—äººå®ä¾‹æ‰©å±•é¢„ç•™**ï¼šåœ¨`child`è¡¨çš„`ai_struct_info`ä¸­é¢„ç•™`digi_preference`å­—æ®µï¼ˆJSONB ç±»å‹ï¼‰ï¼ŒåæœŸå¯å­˜å‚¨å„¿ç«¥åå¥½çš„æ•°å­—äºº IDï¼ˆå¦‚`{"preferred_digi_id":"warm_002"}`ï¼‰ï¼Œåˆ›å»º Session æ—¶è‡ªåŠ¨ä½¿ç”¨åå¥½å®ä¾‹ï¼›
2. **livetalking æ¥å£æ‰©å±•é¢„ç•™**ï¼šåœ¨`LivetalkingClient`ä¸­é¢„ç•™ â€œæ•°å­—äººè¡¨æƒ…æ§åˆ¶â€â€œè¯­éŸ³é£æ ¼åˆ‡æ¢â€ ç­‰æ–¹æ³•ï¼ˆå¦‚`setDigiExpression(String digiSessionId, String expression)`ï¼‰ï¼ŒåæœŸåªéœ€å®ç°å³å¯æ”¯æŒæ›´å¤šäº¤äº’åŠŸèƒ½ï¼›
3. **å‰ç«¯ç”»é¢æµé€‚é…é¢„ç•™**ï¼šèŠå¤©æ¥å£å‡ºå‚è¿”å›`streamUrl`ï¼ˆWebSocket åè®®ï¼‰ï¼Œå‰ç«¯å¯ç›´æ¥é€šè¿‡è¯¥åœ°å€æ‹‰å–æ•°å­—äººç”»é¢ï¼ŒåæœŸæ— éœ€ä¿®æ”¹æ¥å£æ ¼å¼å³å¯é€‚é…ä¸åŒåˆ†è¾¨ç‡ã€å¸§ç‡çš„ç”»é¢æµã€‚

## äº”ã€ä¿®è®¢äº®ç‚¹æ€»ç»“

1. **è½»é‡åŒ–è®¾è®¡**ï¼šç§»é™¤ç‹¬ç«‹æ•°å­—äººä¼šè¯è¡¨ï¼Œå°† Session å…³è”é€»è¾‘åµŒå…¥ç°æœ‰`ai_chat_record`è¡¨ï¼Œå‡å°‘è¡¨ç»“æ„å†—ä½™ï¼Œç¬¦åˆ â€œå¿«é€Ÿäº¤ä»˜â€ éœ€æ±‚ï¼›
2. **èŒè´£æ¸…æ™°**ï¼šæ•°å­—äºº Session çš„çŠ¶æ€ç®¡ç†ï¼ˆå¦‚åˆ›å»ºã€è¿‡æœŸã€å…³é—­ï¼‰å®Œå…¨äº¤ç”± livetalking æœåŠ¡ï¼Œåç«¯ä»…è´Ÿè´£ â€œå…³è”æ ‡è¯†å­˜å‚¨ + æ¥å£è°ƒç”¨â€ï¼Œé¿å…è·¨æœåŠ¡çŠ¶æ€åŒæ­¥å¤æ‚åº¦ï¼›
3. **åŠŸèƒ½é—­ç¯**ï¼šå„¿ç«¥èŠå¤©æµç¨‹ä¸­è‡ªåŠ¨å®Œæˆ â€œæ•°å­—äºº Session åˆ›å»ºâ†’æŒ‡ä»¤åˆ†å‘â†’ç”»é¢æµè·å–â†’è®°å½•å­˜å‚¨â€ï¼ŒåŒæ—¶ä¿ç•™ AI åˆ†æã€æƒ…æ„Ÿæ ‡ç­¾æå–ç­‰æ ¸å¿ƒèƒ½åŠ›ï¼Œç¡®ä¿ â€œAI é™ªä¼´ + ç²¾å‡†æœåŠ¡â€ é—­ç¯å®Œæ•´ï¼›
4. **æ‰©å±•æ€§å¼º**ï¼šé€šè¿‡é¢„ç•™å­—æ®µã€å®¢æˆ·ç«¯æ¥å£å°è£…ï¼ŒåæœŸå¯å¿«é€Ÿæ”¯æŒæ•°å­—äººåå¥½è®¾ç½®ã€è¡¨æƒ…æ§åˆ¶ç­‰åŠŸèƒ½ï¼Œæ— éœ€é‡æ„ç°æœ‰æ¶æ„ã€‚

è¯¥ä¿®è®¢æ–¹æ¡ˆå®Œå…¨é€‚é… â€œæ•°å­—äºº Sessions ç”± livetalking ç”Ÿæˆï¼Œä»…ç»´æŠ¤ç”»é¢ä¼ è¾“ä¸æ–‡æœ¬æŒ‡ä»¤å…³è”â€ çš„éœ€æ±‚ï¼ŒåŒæ—¶ä¿æŒåŸæœ‰æ–¹æ¡ˆçš„è½»é‡åŒ–ä¸é—­ç¯ä¼˜åŠ¿ï¼Œå¯ç›´æ¥æ”¯æ’‘é¡¹ç›®åˆæœŸæ ¸å¿ƒåŠŸèƒ½è½åœ°ã€‚